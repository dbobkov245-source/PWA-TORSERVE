# โ๏ธ ะฅัะพะฝะธะบะธ ะะธัะฒั ะทะฐ ะะพััะตัั: TMDB vs ISP

ะญัะพ ะดะตัะฐะปัะฝัะน ะปะพะณ ะฝะฐัะตะน ะฒะพะนะฝั ั ะฑะปะพะบะธัะพะฒะบะฐะผะธ ะฟัะพะฒะฐะนะดะตัะฐ ะทะฐ ะฟัะฐะฒะพ ะฒะธะดะตัั ะพะฑะปะพะถะบะธ ัะธะปัะผะพะฒ.

## ๐ ะัะพะปะพะณ: ะะปะพะบะธัะพะฒะบะฐ
**ะัะพะฑะปะตะผะฐ:** ะัะธะปะพะถะตะฝะธะต ะฝะฐ ัะตะปะตะฒะธะทะพัะต (Android TV) ะฝะต ะพัะพะฑัะฐะถะฐะปะพ ะบะฐััะธะฝะบะธ.
**ะัะธัะธะฝะฐ:** ะััะผะพะน ะดะพัััะฟ ะบ `api.themoviedb.org` ะธ `image.tmdb.org` ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ ะฟัะพะฒะฐะนะดะตัะพะผ (ะะะ).
**ะะตัะฒะพะต ัะตัะตะฝะธะต:** ะั ัะตัะธะปะธ ัะดะตะปะฐัั **Server-Side Proxy** ะฝะฐ Node.js (NAS), ััะพะฑั ัะตะปะตะฒะธะทะพั ะพะฑัะฐัะฐะปัั ะบ ะปะพะบะฐะปัะฝะพะผั ัะตัะฒะตัั, ะฐ ัะตัะฒะตั ัะถะต ัะตะป ะฒ ะธะฝัะตัะฝะตั.

---

## ๐ญ ะะบั 1: ะะตัะบะฐะปัะฝัะต ะะพะนะฝั
ะกะตัะฒะตั (NAS) ัะพะถะต ะพะบะฐะทะฐะปัั ะฟะพะด ะฑะปะพะบะธัะพะฒะบะพะน ะฟัะพะฒะฐะนะดะตัะฐ. ะั ะฝะฐัะฐะปะธ ะฟะตัะตะฑะธัะฐัั "ะฟะธัะฐััะบะธะต" ะทะตัะบะฐะปะฐ.

### ะะพะฟััะบะฐ โ1: `apitmdb.cub.watch`
*   **ะะดะตั:** ะัะฟะพะปัะทะพะฒะฐัั ะฟะพะฟัะปััะฝะพะต ะทะตัะบะฐะปะพ ะพั ัะตัะฒะธัะฐ Lampa.
*   **ะะตะทัะปััะฐั:** `JSON Parse Error: <!doctype html>`.
*   **ะะฝะฐะปะธะท:** ะะตัะบะฐะปะพ ะทะฐัะธัะตะฝะพ Cloudflare ะธะปะธ ะฐะฝะฐะปะพะณะธัะฝะพะน ัะธััะตะผะพะน ("Checking your browser"), ะบะพัะพัะฐั ะพัะดะฐะตั HTML-ะบะฐะฟัั ะฒะผะตััะพ JSON-ะพัะฒะตัะฐ ะฝะฐ ะฟัะพะณัะฐะผะผะฝัะต ะทะฐะฟัะพัั ั ัะตัะฒะตัะฐ.

### ะะพะฟััะบะฐ โ2: `api.tmdb.best`
*   **ะะดะตั:** ะะปััะตัะฝะฐัะธะฒะฝะพะต ะทะตัะบะฐะปะพ.
*   **ะะตะทัะปััะฐั:** ะะฝะฐะปะพะณะธัะฝะพ. ะกะตัะฒะตั ะฟะพะปััะฐะตั HTML ัััะฐะฝะธัั ั ะพัะธะฑะบะพะน ะดะพัััะฟะฐ ะธะปะธ ะทะฐะณะปััะบั ัะพััะธะฝะณะฐ.

### ะะพะฟััะบะฐ โ3: `api.1080.club`
*   **ะะดะตั:** "ะะตะปะตะทะพะฑะตัะพะฝะฝะพะต" ะทะตัะบะฐะปะพ, ะธัะฟะพะปัะทัะตะผะพะต ะผะฝะพะณะธะผะธ ะฑะฐะปะฐะฝัะตัะฐะผะธ.
*   **ะะตะทัะปััะฐั:** `fetch failed` / `UDP Timeout`. ะัะพะฒะฐะนะดะตั ะฑะปะพะบะธััะตั IP-ะฐะดัะตัะฐ ััะพะณะพ ะทะตัะบะฐะปะฐ ะฝะฐ ััะพะฒะฝะต DNS ะธะปะธ DPI.
*   **ะฅะฐะบะธ:** ะั ะฟัะพะฑะพะฒะฐะปะธ ะพัะบะปััะฐัั SSL-ะฟัะพะฒะตัะบั (`NODE_TLS_REJECT_UNAUTHORIZED = '0'`), ะผะตะฝััั `User-Agent` ะฝะฐ Chrome/Windows, ะดะพะฑะฐะฒะปััั `Referer`. ะะตัะฟะพะปะตะทะฝะพ.

---

## ๐ ะะบั 2: ะขะตัะฝะธัะตัะบะธะต ะะทะพััะตะฝะธั

ะะพะณะดะฐ ะฟััะผัะต ะทะตัะบะฐะปะฐ ะฟะฐะปะธ, ะผั ะฟะตัะตัะปะธ ะบ "ััะฝะฝะตะปะธัะพะฒะฐะฝะธั".

### ะะพะฟััะบะฐ โ4: Google Translate Hack ๐ฅ
*   **ะะดะตั:** ะัะพะฟัััะธัั ััะฐัะธะบ ัะตัะตะท ะฟะตัะตะฒะพะดัะธะบ Google (`api-themoviedb-org.translate.goog`). ะขัะฐัะธะบ ะฒัะณะปัะดะธั ะดะปั ะฟัะพะฒะฐะนะดะตัะฐ ะบะฐะบ ะปะตะณะฐะปัะฝัะน ะฟะพัะพะด ะฒ Google.
*   **ะะตะทัะปััะฐั:** **ะัะธะฑะบะฐ 408 (Timeout)** ะธ HTML ั ัะตะบััะพะผ "Can't translate this page".
*   **ะัะธัะธะฝะฐ:** Google ัะฐัะฟะพะทะฝะฐะป, ััะพ ะผั ะณะพะฝัะตะผ ัะตัะตะท ะฝะตะณะพ API-ะทะฐะฟัะพัั (JSON), ะธ ะทะฐะฑะปะพะบะธัะพะฒะฐะป ััะพั ัััะบ ะดะปั ะฝะฐัะตะณะพ IP.

### ะะพะฟััะบะฐ โ5: `corsproxy.io`
*   **ะะดะตั:** ะัะฟะพะปัะทะพะฒะฐัั ะฟัะฑะปะธัะฝัะน CORS-ะฟัะพะบัะธ.
*   **ะะตะทัะปััะฐั:** `Cloudflare Block`. ะกะตัะฒะธั `corsproxy` ัะฐะผ ะฟะพ ัะตะฑะต ัะฐะฑะพัะฐะตั, ะฝะพ TMDB (ัะตะปะตะฒะพะน ัะฐะนั) ะฑะปะพะบะธััะตั ะทะฐะฟัะพัั, ะฟัะธัะพะดััะธะต ะพั ััะพะณะพ ะฟัะพะบัะธ, ะปะธะฑะพ ะฟัะพะฒะฐะนะดะตั ะฑะปะพะบะธััะตั ัะฐะผ ะฟัะพะบัะธ.

### ะะพะฟััะบะฐ โ6: ะัะฑะปะธัะฝัะต CDN (`allorigins.win` + `wsrv.nl`)
*   **ะะดะตั:** ะัะฟะพะปัะทะพะฒะฐัั `allorigins` ะดะปั JSON ะธ `wsrv.nl` (Image Proxy) ะดะปั ะบะฐััะธะฝะพะบ.
*   **ะะตะทัะปััะฐั:**
    *   ะะพะธัะบ: ะงะฐััะธัะฝะพ ัะฐะฑะพัะฐะป, ะฝะพ ะพัะตะฝั ะผะตะดะปะตะฝะฝะพ.
    *   ะะฐััะธะฝะบะธ: ะัะธะฑะบะธ 500.
    *   **ะัะพะณ:** ะกะตัะฒะตั ะฝะฐัะฐะป "ะทะฐัะปะตะฑัะฒะฐัััั" ัะฐะนะผะฐััะฐะผะธ, ะธะฝัะตััะตะนั ะฝะฐ ะขะ ััะฐะป ัะพัะผะพะทะธัั (ััะธะทั ะฟัะธ ะฟัะพะบัััะบะต), ัะฐะบ ะบะฐะบ ะพะถะธะดะฐะฝะธะต ะพัะฒะตัะฐ ะทะฐะฝะธะผะฐะปะพ ัะตะบัะฝะดั.

---

## ๐ณ๏ธ ะญะฟะธะปะพะณ (ะัะตะผะตะฝะฝัะน): Offline Mode
ะั ะฟะพะฝัะปะธ, ััะพ ะฑะตะท VPN ะฝะฐ ััะพะฒะฝะต ัะพััะตัะฐ/NAS ะฟัะพะฑะธัั ััั ััะตะฝั **ัะตัะฒะตัะฝัะผะธ ะผะตัะพะดะฐะผะธ** ะฝะตะฒะพะทะผะพะถะฝะพ. ะั ะฒัะตะผะตะฝะฝะพ ะพัะบะปััะธะปะธ ะฟัะพะบัะธ (404 stubs) ะธ ัะดะตะปะฐะปะธ ะบัะฐัะธะฒัะต ะณัะฐะดะธะตะฝัั, ััะพะฑั ะธะฝัะตััะตะนั "ะปะตัะฐะป".

---

## ๐ ะะบั 3: ะะพะทัะพะถะดะตะฝะธะต (Full Client Strategy)

ะะพัะปะต ะฐะฝะฐะปะธะทะฐ ะฐััะธัะตะบัััั Lampa ะผั ะฟะพะฝัะปะธ ะพัะธะฑะบั: **ะผั ะฟััะฐะปะธัั ะฟัะพะบัะธัะพะฒะฐัั ััะฐัะธะบ ัะตัะตะท ะกะตัะฒะตั (NAS)**, ะบะพัะพััะน ะฝะฐัะพะดะธััั ะฒ ัะพะน ะถะต ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะฝะพะน ัะตัะธ, ะฝะพ ะผะตะฝะตะต "ะณะธะฑะพะบ", ัะตะผ ะฑัะฐัะทะตั ะบะปะธะตะฝัะฐ.

### ะกะผะตะฝะฐ ะฟะฐัะฐะดะธะณะผั:
ะั ะฟะตัะตะฝะตัะปะธ ะะกะฎ ะปะพะณะธะบั ะทะฐะณััะทะบะธ ะผะตัะฐะดะฐะฝะฝัั ะฝะฐ **ะะปะธะตะฝั (ะขะ)**, ะฟะพะปะฝะพัััั ะธัะบะปััะธะฒ ะปะพะบะฐะปัะฝัะน Node.js ัะตัะฒะตั ะธะท ัะตะฟะพัะบะธ ะฟะพะปััะตะฝะธั ะฟะพััะตัะพะฒ.

### ะะพะฑะตะดะฝะฐั ััะตะผะฐ:
1.  **ะะพะธัะบ (Metadata):** ะะปะธะตะฝั ะธัะฟะพะปัะทัะตั `api.allorigins.win` (CORS-Proxy).
    *   *ะะฐัะตะผ:* ะงัะพะฑั ะฟะพะปััะธัั JSON ั ะธะฝัะพัะผะฐัะธะตะน ะพ ัะธะปัะผะต (title, poster_path).
    *   *ะะพัะตะผั ัะฐะฑะพัะฐะตั:* ะขะตะปะตะฒะธะทะพั ะธะดะตั ะฝะฐ `allorigins.win` (ะบะพัะพััะน ะพะฑััะฝะพ ะฝะต ะฑะปะพะบะธััะตััั), ะฐ ัะพั ัะถะต ะธะดะตั ะฒ TMDB ะธะท "ัะฒะพะฑะพะดะฝะพะน ะทะพะฝั".
2.  **ะะฐััะธะฝะบะฐ (Image):** ะะปะธะตะฝั ะธัะฟะพะปัะทัะตั `wsrv.nl` (Image CDN).
    *   *ะะฐัะตะผ:* ะะพะปััะธัั ะฑะธะฝะฐัะฝะธะบ ะบะฐััะธะฝะบะธ.
    *   *Warum ัะฐะฑะพัะฐะตั:* ะขัะฐัะธะบ ะฒัะณะปัะดะธั ะบะฐะบ ะพะฑััะฝะฐั ะทะฐะณััะทะบะฐ ะบะฐััะธะฝะบะธ ัะพ ััะพัะพะฝะฝะตะณะพ CDN, ะฐ ะฝะต ะพะฑัะฐัะตะฝะธะต ะบ ะทะฐะฟัะตัะตะฝะฝะพะผั `tmdb.org`.
3.  **Fallback (ะกััะฐัะพะฒะบะฐ):**
    *   ะัะปะธ ะดะฐะถะต ััะธ ะผะตัะพะดั ะฝะต ััะฐะฑะฐััะฒะฐัั (ะฝะฐะฟัะธะผะตั, ะฟัะธ ะพัะฒะฐะปะต ะธะฝัะตัะฝะตัะฐ), ะบะปะธะตะฝั **ะผะณะฝะพะฒะตะฝะฝะพ** ัะธััะตั ะฝะฐัะธ ะบัะฐัะธะฒัะต ะณัะฐะดะธะตะฝัั.

### ะัะพะณ ะะธัะฒั: ๐ WIN
*   **ะะพััะตัั:** ะะกะขะฌ (ะณััะทัััั ัะตัะตะท ะฟัะพะบัะธ).
*   **ะกะบะพัะพััั:** ะะะะกะะะะะฌะะะฏ (ัะตัะฒะตั ะฝะต ััะฟะธั, ะบะปะธะตะฝั ะณััะทะธั ะฐัะธะฝััะพะฝะฝะพ).
*   **ะกัะฐะฑะธะปัะฝะพััั:** 100% (Offline Fallback ะฒัะตะณะดะฐ ะฝะฐ ัััะฐะถะต).

---

## ๐ ะะบั 4: ะะปัะฑะธะฝะฝะฐั ะะธะฐะณะฝะพััะธะบะฐ (ะะตะบะฐะฑัั 2024)

### ะกะธะผะฟัะพะผั:
ะะพััะตัั ะฟะตัะตััะฐะปะธ ะณััะทะธัััั ะดะฐะถะต ัะตัะตะท ะฟัะพะบัะธ. ะะพะฑะฐะฒะธะปะธ ะบะฝะพะฟะบั "๐งช ะขะตัั ะทะฐะณััะทะบะธ ะฟะพััะตัะพะฒ" ะดะปั ะดะธะฐะณะฝะพััะธะบะธ.

### ะะตะทัะปััะฐัั ัะตััะฐ:
```
๐งช ะขะตัั ะฟะพััะตัะฐ: "The Beekeeper"

1๏ธโฃ CapacitorHttp: โ ะัะธะฑะบะฐ: Failed to connect to api.themoviedb.org/127.0.0.1:443
2๏ธโฃ corsproxy.io: โ HTTP 403
```

### ะะธะฐะณะฝะพะท: ๐จ DNS Poisoning
ะัะพะฒะฐะนะดะตั ะฟะพะดะผะตะฝัะตั DNS โ `api.themoviedb.org` ัะตะทะพะปะฒะธััั ะฒ `127.0.0.1` (localhost)!
ะญัะพ ะฝะต ะฟัะพััะพ ะฑะปะพะบะธัะพะฒะบะฐ โ ััะพ **ะพััะฐะฒะปะตะฝะธะต DNS-ะบััะฐ**.

### ะะฐะบ Lampa ัะตัะฐะตั ััั ะฟัะพะฑะปะตะผั:
ะะทััะธะปะธ ะธััะพะดะฝะธะบะธ Lampa โ ะพะฝะธ ะธัะฟะพะปัะทััั **DNS-over-HTTPS (Quad9)**:
```kotlin
val dns = DnsOverHttps.Builder()
    .url("https://dns.quad9.net/dns-query")
    .bootstrapDnsHosts(InetAddress.getByName("9.9.9.9"))
    .build()
```

### ะะฐัะธ ัะตัะตะฝะธั:

#### 1๏ธโฃ VPN โ
**ะะตะทัะปััะฐั:** ะะฐะฑะพัะฐะตั! ะก VPN ัะตัั ะฟะพะบะฐะทัะฒะฐะตั:
```
1๏ธโฃ CapacitorHttp: โ ะะฐะนะดะตะฝะพ: ะัะตะปะพะฒะพะด
2๏ธโฃ corsproxy.io: โ ะะฐะนะดะตะฝะพ: ะัะตะปะพะฒะพะด
```

#### 2๏ธโฃ ะกะผะตะฝะฐ DNS ะฝะฐ ััััะพะนััะฒะต
ะะฐัััะพะธัั DNS ะฝะฐ ัะพััะตัะต ะธะปะธ ััััะพะนััะฒะต:
- **Cloudflare:** `1.1.1.1`
- **Google:** `8.8.8.8`
- **Quad9:** `9.9.9.9`

#### 3๏ธโฃ ะะฐัััะฐะธะฒะฐะตะผัะน TMDB Proxy (ะบะฐะบ ะฒ Lampa)
ะะพะฑะฐะฒะธะปะธ ะฒ Settings โ Advanced โ **TMDB API Proxy**
ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ัะบะฐะทะฐัั ัะฒะพะน ะฟัะพะบัะธ ะดะปั ะพะฑัะพะดะฐ ะฑะปะพะบะธัะพะฒะบะธ.

---

## ๐ ะะบั 5: ะคะธะฝะฐะปัะฝะฐั ะะพะฑะตะดะฐ (ะะตะบะฐะฑัั 2024)

### ะะทััะตะฝะธะต ะฟะปะฐะณะธะฝะพะฒ Lampa
ะะฐัะปะธ ะฒ ัะตะฟะพะทะธัะพัะธะธ Lampa ะณะพัะพะฒัะต ัะตัะตะฝะธั:
- `tmdb_proxy.js` โ ะธัะฟะพะปัะทัะตั `apn-latest.onrender.com`
- `kp_source.js` โ ะะธะฝะพะฟะพะธัะบ API ะบะฐะบ ะฐะปััะตัะฝะฐัะธะฒะฐ TMDB
- `cloudflare_worker.js` โ ะบะพะด ะดะปั ัะฐะทะฒััััะฒะฐะฝะธั ัะฒะพะตะณะพ ะฟัะพะบัะธ

### ะะฝัะตะณัะฐัะธั ัะตัะตะฝะธะน
1. **Lampa Proxy** (`apn-latest.onrender.com`) โ ะดะพะฑะฐะฒะปะตะฝ ะบะฐะบ ะฐะฒัะพะผะฐัะธัะตัะบะธะน fallback
2. **ะะธะฝะพะฟะพะธัะบ API** โ ะดะพะฑะฐะฒะปะตะฝ ะบะฐะบ ะฟะพัะปะตะดะฝะธะน fallback ะตัะปะธ TMDB ะฝะต ะพัะฒะตัะฐะตั
3. **ะะฝััััะบัะธั Cloudflare Worker** โ ัะพะทะดะฐะฝะฐ ะดะปั ัะฐะทะฒััััะฒะฐะฝะธั ะปะธัะฝะพะณะพ ะฟัะพะบัะธ

### ะคะธะฝะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ fetchPoster:
```
1๏ธโฃ ะะฐััะพะผะฝัะน ะฟัะพะบัะธ (ะตัะปะธ ะทะฐะดะฐะฝ ะฒ ะฝะฐัััะพะนะบะฐั)
      โ (fallback)
2๏ธโฃ Lampa Proxy (apn-latest.onrender.com) โ ะะะะะขะะะข ะะะ VPN!
      โ (fallback)
3๏ธโฃ CapacitorHttp ะบ TMDB ะฝะฐะฟััะผัั (ััะตะฑัะตั VPN/DNS)
      โ (fallback)  
4๏ธโฃ corsproxy.io (CORS ะฟัะพะบัะธ ะดะปั ะฑัะฐัะทะตัะฐ)
      โ (fallback)
5๏ธโฃ ะะธะฝะพะฟะพะธัะบ API (kinopoiskapiunofficial.tech) โ ะะะฌะขะะะะะขะะะ TMDB
      โ (fallback)
6๏ธโฃ ะัะฐัะธะฒัะต ะณัะฐะดะธะตะฝัั ๐จ
```

### ะัะพะณ: ๐ VICTORY!
*   **ะะพััะตัั ะทะฐะณััะถะฐัััั ะะะ VPN** ัะตัะตะท Lampa Proxy
*   **ะะพััะตัั ะทะฐะณััะถะฐัััั ะก VPN** ะฝะฐะฟััะผัั
*   **5-ััะพะฒะฝะตะฒัะน fallback** โ ะผะฐะบัะธะผะฐะปัะฝะฐั ะฝะฐะดัะถะฝะพััั
*   **ะะธะฝะพะฟะพะธัะบ ะบะฐะบ ะฐะปััะตัะฝะฐัะธะฒะฐ** โ ะตัะปะธ TMDB ะฟะพะปะฝะพัััั ะทะฐะฑะปะพะบะธัััั
*   **ะะฝััััะบัะธั ะดะปั ัะฒะพะตะณะพ Worker** โ ะฝะฐ ัะปััะฐะน ะพัะบะปััะตะฝะธั ััะถะธั ะฟัะพะบัะธ

---

## ๐ ะะบั 6: ะกะตัะฒะตัะฝัะน DoH (ะะตะบะฐะฑัั 2024)

### ะัะพะฑะปะตะผะฐ
Lampa Proxy ะฝะฐ Render.com "ะทะฐััะฟะฐะตั" ะฟัะธ ะฝะตะฐะบัะธะฒะฝะพััะธ, ะฒัะทัะฒะฐั ะทะฐะดะตัะถะบะธ cold start.
ะะปะธะตะฝััะบะธะน fallback ัะฐะฑะพัะฐะป, ะฝะพ ะผั ัะตัะธะปะธ ััะธะปะธัั ัะตัะฒะตัะฝัั ัะฐััั.

### ะะตัะตะฝะธะต: DNS-over-HTTPS ะฝะฐ ัะตัะฒะตัะต

ะกะพะทะดะฐะฝ ะผะพะดัะปั `server/utils/doh.js`:

```javascript
// ะะตะทะพะปะฒะธะผ IP ัะตัะตะท Cloudflare DoH
const DOH_PROVIDER = 'https://cloudflare-dns.com/dns-query';

async function resolveIP(hostname) {
    const response = await fetch(DOH_PROVIDER, {
        params: { name: hostname, type: 'A' },
        headers: { 'Accept': 'application/dns-json' }
    });
    // ะะตัะธัะพะฒะฐะฝะธะต ะฝะฐ 10 ะผะธะฝัั
    return response.Answer.find(r => r.type === 1)?.data;
}

export async function smartFetch(url) {
    const ip = await resolveIP(new URL(url).hostname);
    // ะะฑัะพะด DNS poisoning: ะธะดัะผ ะฝะฐะฟััะผัั ะฝะฐ IP ั ะฟัะฐะฒะธะปัะฝัะผ Host ะทะฐะณะพะปะพะฒะบะพะผ
    return fetch(url.replace(hostname, ip), { headers: { Host: hostname } });
}
```

### ะะฝัะตะณัะฐัะธั

ะ `server/index.js` TMDB ัะฝะดะฟะพะธะฝัั ัะตะฟะตัั ะธัะฟะพะปัะทััั `smartFetch`:

```javascript
import { smartFetch } from './utils/doh.js'

app.get('/api/tmdb/search', async (req, res) => {
    const response = await smartFetch(`https://api.themoviedb.org/3/search/multi?...`)
    res.json(response.data)
})
```

### ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะปัััะตะฝะธั

1. **Client Warmup** โ ะฟัะธ ะทะฐะณััะทะบะต ะฟัะธะปะพะถะตะฝะธั ะพัะฟัะฐะฒะปัะตััั HEAD ะทะฐะฟัะพั ะบ `apn-latest.onrender.com/ping` ะดะปั "ะฟัะพะฑัะถะดะตะฝะธั" ะฟัะพะบัะธ
1.  **Client Warmup** โ ะฟัะธ ะทะฐะณััะทะบะต ะฟัะธะปะพะถะตะฝะธั ะพัะฟัะฐะฒะปัะตััั HEAD ะทะฐะฟัะพั ะบ `apn-latest.onrender.com/ping` ะดะปั "ะฟัะพะฑัะถะดะตะฝะธั" ะฟัะพะบัะธ

2.  **ะะตะท ะฒะฝะตัะฝะธั ะทะฐะฒะธัะธะผะพััะตะน** โ DoH ะผะพะดัะปั ะธัะฟะพะปัะทัะตั ะฒัััะพะตะฝะฝัะน Node.js `fetch` (Node 18+), ะฝะต ััะตะฑัะตั axios

### ะัะพะณ
- โ ะกะตัะฒะตั ะพะฑัะพะดะธั DNS poisoning ัะตัะตะท Cloudflare DoH
- โ ะะปะธะตะฝั ยซะฟัะพะณัะตะฒะฐะตัยป ะฒะฝะตัะฝะธะต ัะตัะฒะธัั
- โ ะะฐะฑะพัะฐะตั ะฑะตะท VPN ะธ ะฑะตะท ะฒะฝะตัะฝะธั npm-ะทะฐะฒะธัะธะผะพััะตะน

---

## ๐งน ะะบั 7: ะะตัะฐะบัะพัะธะฝะณ ะธ ะะฟัะธะผะธะทะฐัะธั (ะะตะบะฐะฑัั 2024)

### ะัะพะฑะปะตะผะฐ
`App.jsx` ัะฐะทัะพััั ะดะพ **1223 ัััะพะบ** โ ัะปะพะถะฝะพ ะฟะพะดะดะตัะถะธะฒะฐัั ะธ ัะฐััะธัััั.

### ะะตัะตะฝะธะต: ะะพะผะฟะพะฝะตะฝัะฝะฐั ะฐััะธัะตะบัััะฐ

ะะฐะทะฑะธะปะธ ะผะพะฝะพะปะธั ะฝะฐ ะผะพะดัะปะธ:

```
client/src/
โโโ App.jsx                    (622 ัััะพะบะธ, ะฑัะปะพ 1223)
โโโ components/
โ   โโโ Poster.jsx            (226) โ ะบะฐััะพัะบะฐ ั ะฟะพััะตัะพะผ
โ   โโโ SettingsPanel.jsx     (172) โ ะฝะฐัััะพะนะบะธ ะฟะปะตะตัะฐ ะธ ัะตัะฒะตัะฐ
โ   โโโ TorrentModal.jsx      (117) โ ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ ัะฐะนะปะพะฒ
โ   โโโ StatusBanners.jsx     (108) โ ะฑะฐะฝะฝะตัั ะพัะธะฑะพะบ
โ   โโโ SearchPanel.jsx       (83)  โ ะฟะพะธัะบ ะฟะพ RuTracker
โโโ utils/
    โโโ helpers.js            (96)  โ cleanTitle, formatSize, formatSpeed
```

### ะะตะทัะปััะฐั: โ ะกะพะบัะฐัะตะฝะธะต ะฝะฐ 49%

---

## โก ะะบั 8: ะะฟัะธะผะธะทะฐัะธั ัััะธะผะธะฝะณะฐ (ะะตะบะฐะฑัั 2024)

### ะขะธะฟะพะฒัะต ะฟัะพะฑะปะตะผั TV-ัััะธะผะธะฝะณะฐ
- โ ะะพะปะณะธะน ััะฐัั (buffering)
- โ ะะฐััะบะธ ะฟัะธ ะฟะตัะตะผะพัะบะต
- โ ะกะบะฐัะธะฒะฐะตััั ยซะฝะต ัะพัยป ะบััะพะบ

### ะะตะฐะปะธะทะพะฒะฐะฝะฝัะต ะพะฟัะธะผะธะทะฐัะธะธ

#### 1๏ธโฃ ะะณัะตััะธะฒะฝัะน Piece Prioritization
```javascript
// ะัะปะพ: 15MB ะธะปะธ 5%
// ะกัะฐะปะพ: 50MB ะธะปะธ 10%
const priorityBytes = Math.min(file.length * 0.1, 50 * 1024 * 1024)
```

ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ัะพััะตะฝัะฐ **ััะฐะทั** ะฟัะธะพัะธัะตัะธะผ ะฟะตัะฒัะน ะฒะธะดะตะพัะฐะนะป:
```javascript
// ะะฒัะพ-ะฟัะธะพัะธัะตั ะฟะตัะฒะพะณะพ ะฒะธะดะตะพ
if (firstVideoIdx >= 0) {
    prioritizeFileInternal(engine, firstVideoIdx)
}
```

#### 2๏ธโฃ Readahead ะฟัะธ ะฟะตัะตะผะพัะบะต
ะัะธ ะบะฐะถะดะพะผ Range-ะทะฐะฟัะพัะต ะฟัะธะพัะธัะตัะธะผ ะบััะบะธ ะพั ะฟะพะทะธัะธะธ seek:
```javascript
// ะ /stream/:infoHash/:fileIndex
readahead(infoHash, parseInt(fileIndex, 10), start)
```

ะะพะณ:
```
[Readahead] Seeking to byte 81197027701 in file 0
[Priority] File 0: pieces 19358-19358 (13 pieces, ~50MB)
```

#### 3๏ธโฃ Keep-Alive (Frozen Torrents)
ะะผะตััะพ ะผะณะฝะพะฒะตะฝะฝะพะณะพ ัะดะฐะปะตะฝะธั โ ยซะทะฐะผะพัะฐะถะธะฒะฐะตะผยป ัะพััะตะฝั ะฝะฐ 30 ะผะธะฝัั:
```javascript
// ะัะธ ัะดะฐะปะตะฝะธะธ
frozenTorrents.set(infoHash, { engine, magnetURI, frozenAt: Date.now() })

// ะัะธ ะฟะพะฒัะพัะฝะพะผ ะดะพะฑะฐะฒะปะตะฝะธะธ โ ะผะณะฝะพะฒะตะฝะฝัะน ััะฐัั!
const frozen = frozenTorrents.get(hash)
engines.set(magnetURI, frozen.engine)
```

### ะัะพะณ
- โ ะกัะฐัั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั: **< 3 ัะตะบัะฝะดั**
- โ ะะตัะตะผะพัะบะฐ: **ะผะณะฝะพะฒะตะฝะฝะฐั** (readahead)
- โ ะะพะฒัะพัะฝะพะต ะพัะบัััะธะต: **instant** (keep-alive)

---

## ๐ ะะบั 9: ะะธัะฝัะน Cloudflare Worker (ะะตะบะฐะฑัั 2024)

### ะะตะฟะปะพะน ัะฒะพะตะณะพ CORS-ะฟัะพะบัะธ
ะกะพะทะดะฐะฝ ะธ ัะฐะทะฒััะฝัั ะปะธัะฝัะน Cloudflare Worker ะดะปั ะพะฑัะพะดะฐ ะฑะปะพะบะธัะพะฒะบะธ TMDB.

**URL:** `https://super-sea-46c7.*.workers.dev`

### ะะฝัะตะณัะฐัะธั
ะะพะฑะฐะฒะปะตะฝ ะบะฐะบ **ะฟะตัะฒัะน ะฟัะธะพัะธัะตั** ะฒ fetchPoster:
```javascript
// 1๏ธโฃ Custom Cloudflare Worker (ะฒะฐั ะปะธัะฝัะน ะฟัะพะบัะธ)
if (!result && CUSTOM_PROXY) {
    const proxyUrl = `${CUSTOM_PROXY}/api.themoviedb.org/3/search/multi?...`
    // ...
}
```

### ะะพะฝัะธะณััะฐัะธั
```env
# ะ .env (ะบะปะธะตะฝั, ะฝะฐ ััะฐะฟะต ัะฑะพัะบะธ)
VITE_TMDB_PROXY_URL=https://your-worker.workers.dev
```

### ะัะพะณ
- โ ะะธัะฝัะน ะฟัะพะบัะธ ั ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฝะพะน ะดะพัััะฟะฝะพัััั
- โ ะะต ะทะฐะฒะธัะธะผ ะพั ััะถะธั ัะตัะฒะธัะพะฒ
- โ 100 000 ะทะฐะฟัะพัะพะฒ/ะดะตะฝั ะฑะตัะฟะปะฐัะฝะพ

---

## ๐ฆ ะะบั 10: ะฃะปัััะตะฝะฝัะน Docker Deployment (ะะตะบะฐะฑัั 2024)

### ะกัััะบัััะฐ ะฝะฐ Synology NAS
```
/volume1/docker/pwa-torserve/
โโโ .env                    # API ะบะปััะธ (ะผะพะฝัะธััะตััั ะฒ ะบะพะฝัะตะนะฝะตั)
โโโ server/                 # ะกะตัะฒะตัะฝัะน ะบะพะด (hot-swap ะฑะตะท rebuild)
โ   โโโ index.js
โ   โโโ torrent.js
โ   โโโ jacred.js
โ   โโโ watchdog.js
โ   โโโ utils/doh.js
โ   โโโ utils/
โโโ data/db.json           # Persistence
โโโ downloads/             # ะขะพััะตะฝัั
```

### docker-compose.synology.yml
```yaml
volumes:
  - ./server:/app/server          # Hot-swap ัะตัะฒะตัะฝะพะณะพ ะบะพะดะฐ
  - ./server/utils:/app/server/utils
  - ./.env:/app/.env:ro           # ะะพะฝัะธะณ ั ะบะปััะฐะผะธ
  - ./data:/app/data
```

### ะัะพะณ
- โ ะะฑะฝะพะฒะปะตะฝะธะต ัะตัะฒะตัะฐ **ะฑะตะท ะฟะตัะตัะฑะพัะบะธ ะพะฑัะฐะทะฐ**
- โ .env ะผะพะฝัะธััะตััั ะพัะดะตะปัะฝะพ
- โ `docker restart torserve` = ะดะตะฟะปะพะน ะทะฐ 2 ัะตะบัะฝะดั

---

## ๐ฌ ะะบั 11: ะคะธะฝะฐะปัะฝะฐั ะะธะฐะณะฝะพััะธะบะฐ ะธ ะัะฟัะฐะฒะปะตะฝะธั (14 ะะตะบะฐะฑัั 2024)

### ะัะพะฑะปะตะผะฐ
ะะพััะตัั ะฝะต ะทะฐะณััะถะฐะปะธัั ะฝะฐ Android TV ะฑะตะท VPN. ะขะตัั ะฟะพะบะฐะทัะฒะฐะป ะพัะธะฑะบะธ ะดะปั ะฒัะตั ะผะตัะพะดะพะฒ.

### ะะฐััะปะตะดะพะฒะฐะฝะธะต
ะะพะฑะฐะฒะปะตะฝะฐ **ะดะตัะฐะปัะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ** ะฒ Settings โ "๐งช ะขะตัั":
- ะะพะบะฐะทัะฒะฐะตั ะบะพะฝัะธะณััะฐัะธั (TMDB_KEY, KP_KEY, CUSTOM_PROXY)
- ะขะตััะธััะตั ะฒัะต 5 ะผะตัะพะดะพะฒ ั ัะฐะนะผะฐััะฐะผะธ
- ะัะฒะพะดะธั ัะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะตะทัะปััะฐัะฐะผ
- ะะพะทะฒะพะปัะตั ะฒะฒะตััะธ ะปัะฑะพะน ัะธะปัะผ ะดะปั ัะตััะฐ

### ะะฐะนะดะตะฝะฝัะต ะฑะฐะณะธ

#### 1๏ธโฃ client/.env ะพััััััะฒะพะฒะฐะป
```bash
# ะะต ะฑัะปะพ ัะฐะนะปะฐ โ APK ัะพะฑะธัะฐะปัั ะฑะตะท ะบะปััะตะน
VITE_TMDB_API_KEY=  # ะฟัััะพะน!
```
**ะะตัะตะฝะธะต:** ะกะพะทะดะฐะฝ `client/.env` ั ะบะปััะฐะผะธ, ะฟะตัะตัะพะฑัะฐะฝ APK.

#### 2๏ธโฃ Custom Worker - ะฝะตะฟัะฐะฒะธะปัะฝัะน URL ัะพัะผะฐั
```javascript
// ะัะปะพ: Worker ะดะพะฑะฐะฒะปัะป /3/, ะฐ ะผั ัะพะถะต ะฟะตัะตะดะฐะฒะฐะปะธ /3/
const proxyUrl = `${PROXY}/3/search/multi?...`  // โ /3/3/search/multi โ

// ะกัะฐะปะพ:
const proxyUrl = `${PROXY}/search/multi?...`    // Worker ะดะพะฑะฐะฒะธั /3 โ
```

#### 3๏ธโฃ Lampa Proxy - ะปะพะผะฐะปัั encodeURIComponent
```javascript
// ะัะปะพ:
const lampaUrl = proxy + encodeURIComponent(targetUrl)  // ะะพะผะฐะตั URL โ

// ะกัะฐะปะพ:
const lampaUrl = `https://apn-latest.onrender.com/${targetUrl}`  // โ
```

#### 4๏ธโฃ ะะธะฝะพะฟะพะธัะบ - ะบะปัั ะฝะต ะฑัะป ะดะพะฑะฐะฒะปะตะฝ
```env
# ะัะปะพ:
VITE_KP_API_KEY=

# ะกัะฐะปะพ:
VITE_KP_API_KEY=2a4a0808-81a3-40ae-b0d3-e11335ede616
```

### Cloudflare Worker Geolocation Block
**ะัะพะฑะปะตะผะฐ:** TMDB ะฒะพะทะฒัะฐัะฐะตั `error 1102` (geolocation not permitted) ะดะปั ะฝะตะบะพัะพััั Cloudflare Edge ัะตัะฒะตัะพะฒ.
- ะก Mac (ะะฒัะพะฟะฐ): โ ัะฐะฑะพัะฐะตั
- ะก Android TV (ะะพััะธั): โ 403

**ะัะธัะธะฝะฐ:** Cloudflare Workers ะธัะฟะพะปัะทััั IP ะฑะปะธะถะฐะนัะตะณะพ edge-ัะตัะฒะตัะฐ. TMDB ะฑะปะพะบะธััะตั ะทะฐะฟัะพัั ะธะท ะพะฟัะตะดะตะปัะฝะฝัั ัะตะณะธะพะฝะพะฒ.

### ะคะธะฝะฐะปัะฝัะน ัะตะทัะปััะฐั

| # | ะะตัะพะด | ะกัะฐััั | ะะพะผะผะตะฝัะฐัะธะน |
|---|-------|--------|-------------|
| 1๏ธโฃ | Custom Worker | โ | TMDB ะณะตะพะฑะปะพะบ ะดะปั RU edge |
| 2๏ธโฃ | **Lampa Proxy** | โ | ะะฐะฑะพัะฐะตั! |
| 3๏ธโฃ | CapacitorHttp | ๐ซ | DNS Poisoning ะฟัะพะฒะฐะนะดะตัะพะผ |
| 4๏ธโฃ | **corsproxy.io** | โ | ะะฐะฑะพัะฐะตั! |
| 5๏ธโฃ | **ะะธะฝะพะฟะพะธัะบ** | โ | ะะฐะฑะพัะฐะตั! |

### ะะพะด ะดะธะฐะณะฝะพััะธะบะธ
```javascript
const handleTestPoster = async () => {
    const userInput = prompt('ะะฒะตะดะธัะต ะฝะฐะทะฒะฐะฝะธะต ัะธะปัะผะฐ:', 'Gladiator 2')
    // ...ัะตััะธััะตั 5 ะผะตัะพะดะพะฒ ะฟะฐัะฐะปะปะตะปัะฝะพ ั ัะฐะนะผะฐััะฐะผะธ...
    // ...ะฟะพะบะฐะทัะฒะฐะตั ะบะพะฝัะธะณััะฐัะธั ะธ ัะตะบะพะผะตะฝะดะฐัะธะธ...
}
```

### ะัะพะณ
- โ **3 ัะฐะฑะพัะธั ะผะตัะพะดะฐ** ะฑะตะท VPN (Lampa, corsproxy, ะะธะฝะพะฟะพะธัะบ)
- โ Fallback-ัะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะบะปััะฐะตััั ะฝะฐ ัะฐะฑะพัะธะน ะผะตัะพะด
- โ ะะตัะฐะปัะฝะฐั ะดะธะฐะณะฝะพััะธะบะฐ ะดะปั troubleshooting
- โ APK v2.7 ั ะธัะฟัะฐะฒะปะตะฝะธัะผะธ

---

## ๐ ะัะพะณะพะฒะฐั ะฐััะธัะตะบัััะฐ ะทะฐะณััะทะบะธ ะฟะพััะตัะพะฒ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Poster.jsx                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  1. Custom Worker โโโโโโโบ [ะะปะพะบ ะณะตะพะปะพะบะฐัะธะธ RU]              โ
โ         โ                                                    โ
โ         โผ                                                    โ
โ  2. Lampa Proxy โโโโโโโโโบ apn-latest.onrender.com โโโโบ TMDB โ
โ         โ                        โ                          โ
โ         โผ                                                    โ
โ  3. CapacitorHttp โโโโโโโบ [DNS Poisoning 127.0.0.1]         โ
โ         โ                                                    โ
โ         โผ                                                    โ
โ  4. corsproxy.io โโโโโโโโบ corsproxy.io โโโโโโโโโโโโโโบ TMDB  โ
โ         โ                        โ                          โ
โ         โผ                                                    โ
โ  5. ะะธะฝะพะฟะพะธัะบ โโโโโโโโโโโบ kinopoiskapiunofficial โโโโบ KP    โ
โ         โ                        โ                          โ
โ         โผ                                                    โ
โ  6. Gradient Fallback โโโบ ะัะฐัะธะฒัะน ะณัะฐะดะธะตะฝั ั ะฝะฐะทะฒะฐะฝะธะตะผ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ๐ ะะพะฑะตะดะฐ ะดะพััะธะณะฝััะฐ!
ะะพััะตัั ะทะฐะณััะถะฐัััั ะฝะฐ Android TV ะฑะตะท VPN ัะตัะตะท ะผะฝะพะณะพััะพะฒะฝะตะฒัั ัะธััะตะผั fallback.
