# Session 2026-02-13: BUG-STREAM-01 ‚Äî Filesystem Fallback

## –ü—Ä–æ–±–ª–µ–º–∞

–°–∫–∞—á–∞–Ω–Ω—ã–µ —Ç–æ—Ä—Ä–µ–Ω—Ç—ã –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞. –ü–ª–µ–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è, –Ω–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –∂–¥–∞–ª –¥–∞–Ω–Ω—ã–µ.

**–°–∏–º–ø—Ç–æ–º—ã:**
- `[Turbo] Current connections: 0/65` ‚Äî 0 –ø–∏—Ä–æ–≤
- –ü–ª–µ–µ—Ä –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ loading
- –¢–æ—Ä—Ä–µ–Ω—Ç—ã –≤–∏–¥–Ω—ã –≤ UI (isReady: true –∏–∑ DB)

## Root Cause

`torrent-stream` —Å `verify: false` ‚Üí –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ engine –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ magnet, –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ñ–∞–π–ª–∞—Ö –Ω–∞ –¥–∏—Å–∫–µ ‚Üí `file.createReadStream()` –∂–¥—ë—Ç pieces –æ—Ç –ø–∏—Ä–æ–≤ ‚Üí 0 peers ‚Üí –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∑–∞–≤–∏—Å–∞–Ω–∏–µ.

## –†–µ—à–µ–Ω–∏–µ

**Filesystem fallback** –≤ `/stream/:infoHash/:fileIndex` (`server/index.js`):

1. –ü–µ—Ä–µ–¥ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º ‚Äî `fs.statSync(diskPath)` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ
2. –ï—Å–ª–∏ `stat.size >= file.length` ‚Üí —Ñ–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–∞—á–∞–Ω
3. –°—Ç—Ä–∏–º —á–µ—Ä–µ–∑ `fs.createReadStream()` –≤–º–µ—Å—Ç–æ `file.createReadStream()`
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Range requests, highWaterMark, error handling
5. `readahead()` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç—Ä–∏–º–µ —Å –¥–∏—Å–∫–∞

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `server/index.js` ‚Äî filesystem fallback –≤ `/stream` endpoint

## –†–µ–∑—É–ª—å—Ç–∞—Ç

```
[Stream] üìÅ Serving from disk: Der.Tiger.2025.2025.x265.WEB-DL.2160p.HDR10Plus.mkv (13086.7 MB)
```

–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –ø–∏—Ä–æ–≤.
