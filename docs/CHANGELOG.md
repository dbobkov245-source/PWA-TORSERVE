# Changelog

All notable changes to this project will be documented in this file.

## [3.9.0] - 2026-02-15

### Fixed
- **Voice Search (Rollback):** Полный откат на простую и надежную логику поиска v3.7.2 (`popup: true`). Исправлена ошибка, когда пользователя игнорировало при первом нажатии (зависал без UI).
- **Auto-Update:** Исправлена ошибка циклического скачивания обновления. Теперь при запуске приложение проверяет наличие уже скачанного APK и сразу предлагает установку.

## [3.8.4] - 2026-02-15 (Hotfix)

### Fixed
- **Voice Search:** Исправлен кейс, когда требовалось дважды нажимать кнопку микрофона (добавлены дедупликация in-flight вызовов и retry fallback при `RecognitionService busy`).
- **Voice Search:** Стабилизирован переход `primary -> fallback` после timeout (защитный `stop()` + небольшая задержка перед popup-режимом).
- **Auto-Update:** Исправлен переход в установщик APK (добавлена проверка и явная обработка разрешения `Install unknown apps`, запуск через `ACTION_INSTALL_PACKAGE`).
- **Auto-Update:** Устранена повторная загрузка APK после принудительного перезапуска приложения (переиспользование кэшированного APK через pending-install state).

## [3.8.1] - 2026-02-15 (Hotfix)

### Fixed
- **Voice Search:** Временно отключен Hybrid Mode (popup:false) из-за зависаний. Возврат к `popup:true`.
- **Freeze:** Исправлено зависание кнопки микрофона (добавлены таймауты).

## [3.8.0] - 2026-02-15

### Added
- **Hybrid Voice Search (Этап 1):** Новая логика голосового поиска. Сначала выполняется "тихая" попытка (без системного окна), если за 4 секунды результат не получен — открывается стандартный диалог. Это решает проблему с закрытием приложения на Sony Android 10.
- **Graceful Cancel:** Отмена голосового поиска кнопкой "Назад" теперь происходит тихо, без лишних уведомлений.

### Changed
- **Side Panel Design:** Полностью переработан дизайн боковой панели. Убраны лишние тени и границы, унифицирован фон (`bg-[#141414]`), удалён логотип для увеличения полезного пространства.
- **Performance:** Оптимизирована анимация открытия боковой панели (используется `transform` вместо `width/margin`).

### Fixed
- **Voice Search Fallback:** Исправлена ошибка, из-за которой отмена голосового поиска могла приводить к сбою или некорректному поведению на некоторых устройствах.
