# ADR-004: Anti-DPI Infrastructure Strategy (Server-Centric)

**–°—Ç–∞—Ç—É—Å:** üîí FROZEN
**–î–∞—Ç–∞:** 2026-02-02
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** Android TV / PWA / –†–§
**–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Å–ª–æ–∏:** Client Network Layer, Proxy Layer, Worker Layer, Local Server

---

## üß© –ö–æ–Ω—Ç–µ–∫—Å—Ç

–í —É—Å–ª–æ–≤–∏—è—Ö DPI-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ SNI/DNS poisoning –≤ –†–§:

–ë—Ä–∞—É–∑–µ—Ä –∏ WebView –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫:
- MTU
- TTL
- TCP window size
- Raw sockets
- TCP segmentation

–õ—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫–∏ —É—Ä–æ–≤–Ω—è ByeDPI –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏.

–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

üëâ **–í—Å–µ DPI-bypass —Ç–µ—Ö–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞** ‚Äî –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–∫—Å–∏, –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

–ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è —á–∏—Å—Ç—ã–º, —Ç—É–ø—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.

---

## üéØ –¶–µ–ª—å —Ä–µ—à–µ–Ω–∏—è

- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º API (TMDB, KP, Images) –±–µ–∑ VPN
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–ª–æ—ë–≤
- –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π UX –Ω–∞ TV
- –ò—Å–∫–ª—é—á–∏—Ç—å DPI-–ª–æ–≥–∏–∫—É –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

```
Client
  |
  v
[ Custom Worker ]
      |
      v
[ Lampa Proxy ]
      |
      v
[ Local Server (NAS / VPS) ]
      |
      v
[ Direct Internet ]
```

–ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Å–∫–∞–¥ / race —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–∏–º —Å–ª–æ—è–º.

---

## ‚úÖ –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (Why it works)

### 1. –ü—Ä–∏–∑–Ω–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å—Ä–µ–¥—ã

- Browser/WebView sandbox –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ByeDPI-–ø–æ–¥–æ–±–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞
- ‚û° DPI-bypass –≤—ã–Ω–æ—Å–∏—Ç—Å—è –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

### 2. –ó–∞—â–∏—Ç–∞ UX

- –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞
- –ï—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ —É–ø–∞–ª ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π
- UI –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- **Graceful Degradation** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ.

### 3. Defense in Depth

- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ Worker ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è Proxy
- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ Proxy ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è Local Server
- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –≤—Å—ë ‚Üí UI –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ offline/fallback —Ä–µ–∂–∏–º
- **–ù–µ—Ç –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞.**

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### RISK-01: Waterfall Latency

–ï—Å–ª–∏ –∫–∞–∂–¥—ã–π —Å–ª–æ–π –∂–¥–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ–π.

**–†–µ—à–µ–Ω–∏–µ: Hybrid Strategy**
- Worker –∏ Proxy —Å—Ç–∞—Ä—Ç—É—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ü–æ–±–µ–∂–¥–∞–µ—Ç –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç–∏–≤—à–∏–π
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è

### RISK-02: TLS Fingerprinting (JA3)

Node.js –∏–º–µ–µ—Ç —É–∑–Ω–∞–≤–∞–µ–º—ã–π TLS ClientHello.
–î–∞–∂–µ –∏–¥–µ–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ —Å–ø–∞—Å–∞—é—Ç.

**–†–µ—à–µ–Ω–∏–µ (Server-side):**
- `got-scraping` / `tls-ciphers` –≤ Node
- –∏–ª–∏ Go-–ø—Ä–æ–∫—Å–∏ —Å `uTLS`
- Header spoofing –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω.

### RISK-03: DoH Bootstrap Problem

–ß—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ DoH-—Å–µ—Ä–≤–µ—Ä—É, –Ω—É–∂–µ–Ω DNS.
DNS –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∞–≤–ª–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**

–í –∫–ª–∏–µ–Ω—Ç–µ —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è IP DoH-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
```
1.1.1.1
8.8.8.8
9.9.9.9
```

DoH –ø–æ IP ‚Üí Host header ‚Üí HTTPS.

---

## üîí –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ù–ï –ù–ê–†–£–®–ê–¢–¨)

1. –ö–ª–∏–µ–Ω—Ç **–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç** DPI-–±–∞–π–ø–∞—Å
2. –ö–ª–∏–µ–Ω—Ç **–Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç** TCP
3. –í—Å–µ –æ–±—Ö–æ–¥—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–ª–æ—è—Ö
4. –ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ HTTPS
5. Fallback **–≤—Å–µ–≥–¥–∞** —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

## üß† –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

**–ü–ª—é—Å—ã:**
- –í—ã—Å–æ–∫–∞—è –∂–∏–≤—É—á–µ—Å—Ç—å
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PWA
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ö–∞–∫–∞—é—â–∏—Ö —Ç—Ä—é–∫–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –¢—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–ª–æ—ë–≤

–û–±–∞ –ø—É–Ω–∫—Ç–∞ –ø—Ä–∏–Ω—è—Ç—ã –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ.

---

## ‚ûï ROADMAP EXTENSION (–Ω–∞ –æ—Å–Ω–æ–≤–µ ADR-004)

### üü° SHOULD: Smart Timeout & Race Strategy

**–¶–µ–ª—å:** —É–±—Ä–∞—Ç—å –∫–∞—Å–∫–∞–¥–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.

- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ Worker + Proxy
- –¢–∞–π–º–∞—É—Ç –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è: 1500ms
- –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –û—Å—Ç–∞–ª—å–Ω—ã–µ `abort()`

### üü° SHOULD: Adaptive Timeout Memory

–•—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–≤–µ—Ç–æ–≤:
```
provider ‚Üí avgLatency
```

- –ï—Å–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ = 300ms ‚Üí —Ç–∞–π–º–∞—É—Ç = 800ms
- –ï—Å–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ = 2s ‚Üí —Ç–∞–π–º–∞—É—Ç = 3s

### üü° SHOULD: Circuit Breaker

–ï—Å–ª–∏ —Å–ª–æ–π –¥–∞–ª 5 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥:
```
disabledUntil = now + 5 minutes
```

–ö–ª–∏–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–ª–æ–π.

### üü° SHOULD: Server-side User-Agent Rotation

–ü—Ä–æ–∫—Å–∏:
- —Å–ª—É—á–∞–π–Ω—ã–π Chrome UA
- —Å–ª—É—á–∞–π–Ω—ã–π Firefox UA
- –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏

### üü° SHOULD: TLS Fingerprint Camouflage

–ù–∞ Local Server:
- `got-scraping`
- –∏–ª–∏ Go + `uTLS`

---

## üìå –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∑–∏—Å

> **–ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç—É–ø—ã–º –∏ —á–∏—Å—Ç—ã–º.**
> **–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–∏—Ç—Ä—ã–º.**

ADR-004 –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å ByeDPI –¥–ª—è PWA-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –Ω–∞–≤—Å–µ–≥–¥–∞.

---

### ‚ùó –°–≤—è–∑–∞–Ω–Ω—ã–µ ADR
- [ADR-002: Zone Management](./ADR-002-Zone-Management.md)
- [ADR-003: Sidebar / NUM Navigation Model](./ADR-003-Sidebar-Navigation.md)
