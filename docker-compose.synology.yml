version: '3.8'

services:
  torserve:
    # Use the image built previously or build it here if you transfer the source.
    # Assuming user might build on NAS or pull from a registry. If building on NAS:
    build: .
    image: pwa-torserve:latest
    container_name: torserve
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DOWNLOAD_PATH=/app/downloads
      - DB_PATH=/app/data/db.json
    volumes:
      # Downloads folder (map to your NAS media folder)
      - /volume1/docker/pwa-torserve/downloads:/app/downloads
      # [HOTFIX] Map source code for easy updates without rebuild
      - ./server:/app/server
      # Utils folder (for DoH and other utilities)
      - ./server/utils:/app/server/utils
      # Environment file with API keys
      - ./.env:/app/.env:ro
      # Persistence for DB
      - ./data:/app/data
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

