# üì∫ PWA-TorServe

**–°–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–π—Å—è —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è Android TV, –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –±—Ä–∞—É–∑–µ—Ä–∞.**

–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ—Ä—Ä–µ–Ω—Ç—ã **–æ–Ω–ª–∞–π–Ω –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è**, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–Ω–µ—à–Ω–∏—Ö –ø–ª–µ–µ—Ä–æ–≤ (Vimu, VLC, MX Player) –ø—Ä—è–º–æ –∏–∑ PWA. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Synology NAS, Raspberry Pi, –¥–æ–º–∞—à–Ω–µ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –≤ Docker.

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

## ‚ú® –ü–æ—á–µ–º—É PWA-TorServe?

- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç** ‚Äî –≤–∏–¥–µ–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–∞—Ç—å —á–µ—Ä–µ–∑ 5‚Äì10 —Å–µ–∫—É–Ω–¥ (–¥–∞–∂–µ 4K HDR)
- **Self-Healing** ‚Äî watchdog —Å circuit breaker, RAM-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π —Ñ–∞–π–ª–æ–≤
- **Native –ø–ª–µ–µ—Ä—ã** ‚Äî Vimu/VLC/MX –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∏–∑ PWA (Capacitor bridge)
- **TV-friendly UI** ‚Äî Netflix-–ø–æ–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ñ–æ–∫—É—Å–æ–º –∏ –±–æ–ª—å—à–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
- **Docker-first** ‚Äî –æ–¥–∏–Ω —Ñ–∞–π–ª `docker-compose.yml` ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ NAS –∑–∞ 1 –º–∏–Ω—É—Ç—É

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| üì∫ **–°—Ç—Ä–∏–º–∏–Ω–≥** | –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (torrent-stream) |
| üîç **–ü–æ–∏—Å–∫** | Jacred (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–µ—Ä–∫–∞–ª–∞) |
| ‚ö° **Turbo Mode** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ |
| üé¨ **Smart Priority** | –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤—ã—Ö –∫—É—Å–∫–æ–≤ –≤–∏–¥–µ–æ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ |
| üñºÔ∏è **–ü–æ—Å—Ç–µ—Ä—ã** | TMDB/Kinopoisk —Å –æ–±—Ö–æ–¥–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ |
| üìã **M3U Playlist** | –î–ª—è Kodi/Plex/VLC |
| üßπ **File Hygiene** | –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞ |
| üõ°Ô∏è **Watchdog** | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RAM, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, auto-restart |

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|-----------|------------|
| **Backend** | Node.js, Express, torrent-stream, lowdb |
| **Frontend** | React 19, Vite 7, TailwindCSS 4 |
| **Mobile/TV** | Capacitor 6 (APK + native bridge) |
| **DevOps** | Docker, Docker Compose (multi-stage) |
| **–û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** | DoH, Cloudflare Worker, wsrv.nl |

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫
mkdir -p /volume1/docker/pwa-torserve/downloads

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up -d
```

–î–æ—Å—Ç—É–ø: `http://–≤–∞—à-ip:3000`

### –í–∞—Ä–∏–∞–Ω—Ç 2: Raspberry Pi / Linux

```bash
git clone https://github.com/yourusername/pwa-torserve.git
cd pwa-torserve
npm install
npm run client:build
npm start
```

### –ö–ª–∏–µ–Ω—Ç (Android TV / Phone)

1. –í –ø–∞–ø–∫–µ `client`:
   ```bash
   npm install
   npm run build
   npx cap sync
   ```
2. –°–æ–±–µ—Ä–∏—Ç–µ APK:
   ```bash
   cd android
   ./gradlew assembleDebug
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `app-debug.apk` –Ω–∞ –¢–í-–±–æ–∫—Å.

**Web/PWA**: –û—Ç–∫—Ä–æ–π—Ç–µ `http://–≤–∞—à-ip:3000` ‚Üí "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω".

---

## ‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í—Å—Ç–∞–≤—å—Ç–µ **magnet-—Å—Å—ã–ª–∫—É** ‚Üí **Add**
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (5-10 —Å–µ–∫)
4. –ù–∞–∂–º–∏—Ç–µ **‚ñ∂ WATCH** ‚Üí –≤–∏–¥–µ–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ Vimu/VLC/MX Player

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
pwa-torserve/
‚îú‚îÄ‚îÄ server/              # Backend + API + Watchdog
‚îÇ   ‚îú‚îÄ‚îÄ index.js         # Express API
‚îÇ   ‚îú‚îÄ‚îÄ torrent.js       # Torrent engine
‚îÇ   ‚îú‚îÄ‚îÄ watchdog.js      # Self-healing —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ jacred.js        # –ü–æ–∏—Å–∫ —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ utils/           # Helpers (logger, DoH)
‚îú‚îÄ‚îÄ client/              # React PWA
‚îÇ   ‚îú‚îÄ‚îÄ src/components/  # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ android/         # Native Capacitor bridge
‚îú‚îÄ‚îÄ Dockerfile           # Multi-stage build
‚îú‚îÄ‚îÄ docker-compose.yml   # Production deploy
‚îî‚îÄ‚îÄ README.md
```

---

## üÜï –ù–µ–¥–∞–≤–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- ‚úÖ **Structured Logger** ‚Äî ISO timestamps, —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤, –º–æ–¥—É–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ **Unit Tests** ‚Äî 13 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **Debug API** ‚Äî `/api/db/torrents` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- ‚úÖ **isReady Fix** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤
- ‚úÖ **SSL Documentation** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ security tradeoffs

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ API –∫–ª—é—á–µ–π
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`
- DoH –¥–ª—è –æ–±—Ö–æ–¥–∞ DNS-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ security tradeoffs

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –Ω–∞ Android TV?**  
A: –î–∞! –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Vimu/VLC/MX Player —á–µ—Ä–µ–∑ native intent.

**Q: –ö–∞–∫ –æ–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É TMDB?**  
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloudflare Worker –∏–ª–∏ Kinopoisk API (—Å–º. `.env.example`).

**Q: –°–∫–æ–ª—å–∫–æ RAM –Ω—É–∂–Ω–æ?**  
A: 512 –ú–ë‚Äì1 –ì–ë –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (watchdog –∑–∞—â–∏—Ç–∏—Ç –æ—Ç OOM).

**Q: –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã?**  
A: `node server/__tests__/run-tests.js`

---

## üìã API Endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/api/status` | GET | –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ |
| `/api/add` | POST | –î–æ–±–∞–≤–∏—Ç—å magnet |
| `/api/delete/:hash` | DELETE | –£–¥–∞–ª–∏—Ç—å —Ç–æ—Ä—Ä–µ–Ω—Ç |
| `/stream/:hash/:index` | GET | –°—Ç—Ä–∏–º–∏–Ω–≥ —Ñ–∞–π–ª–∞ |
| `/api/db/torrents` | GET | –°–ø–∏—Å–æ–∫ –≤ –ë–î (debug) |
| `/api/db/torrents` | DELETE | –û—á–∏—Å—Ç–∏—Ç—å –ë–î |
| `/playlist.m3u` | GET | M3U –ø–ª–µ–π–ª–∏—Å—Ç |

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ.

---

## ‚ù§Ô∏è –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç

–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–º–æ–≥ ‚Äî –ø–æ—Å—Ç–∞–≤—å—Ç–µ ‚≠ê –Ω–∞ GitHub.

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞.